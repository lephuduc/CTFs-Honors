# mem: DWORD *
# mem[0x254]: saved input in memory
# mem[0x320]: len
# mem[0x1e]: format flag

#1. check len = 0x1a (included \n)
#2. check format flag

# mul c0,0x99
#test input: ptm{abcdefghijklmnopqrst}
import numpy as np


f = open('memory.vm','rb')
d = f.read()
address = 0xfa0
m = []
for i in range(20):
    row_bytes = d[address:address+20*4]
    row = [int.from_bytes(row_bytes[j:j+4],'little') for j in range(0,len(row_bytes),4)]
    address += 20*4
    m.append(row)
address = 0x14
res_bytes = d[0x14:0x14+20*4]
res = [int.from_bytes(res_bytes[j:j+4],'little') for j in range(0,len(res_bytes),4)]
print(res)
print(m)
#

#solve in sage
from ast import literal_eval
from sage.all import matrix, vector

x = [234808, 212936, 249090, 162640, 252814, 240199, 195946, 216205, 231475, 235904, 213608, 194503, 211950, 233610, 231429, 221924, 222013, 176194, 215334, 204687]
x = vector(x)

mat = [[153, 141, 117, 21, 48, 135, 175, 149, 116, 172, 114, 82, 43, 74, 98, 64, 50, 22, 131, 84], [83, 115, 29, 52, 176, 81, 28, 84, 154, 87, 81, 140, 91, 90, 150, 103, 134, 78, 88, 177], [80, 80, 124, 43, 156, 92, 173, 102, 54, 79, 132, 85, 103, 141, 174, 178, 40, 139, 23, 61], [156, 126, 160, 84, 123, 96, 56, 84, 26, 44, 47, 3, 23, 27, 169, 115, 80, 127, 53, 2], [14, 139, 120, 51, 95, 127, 44, 44, 115, 100, 157, 101, 136, 142, 19, 92, 47, 117, 5, 188], [73, 91, 23, 97, 76, 167, 108, 78, 106, 40, 45, 52, 80, 107, 103, 38, 190, 70, 8, 197], [71, 40, 28, 94, 30, 122, 2, 102, 90, 41, 88, 6, 156, 107, 132, 188, 107, 198, 197, 49], [117, 31, 118, 99, 79, 40, 48, 54, 152, 76, 30, 161, 171, 186, 111, 62, 11, 51, 37, 99], [76, 69, 122, 137, 198, 87, 164, 60, 74, 188, 151, 151, 12, 82, 8, 10, 169, 52, 114, 109], [67, 126, 79, 59, 28, 166, 80, 193, 68, 164, 135, 5, 91, 83, 192, 139, 154, 105, 107, 29], [120, 21, 94, 81, 61, 137, 177, 177, 113, 114, 68, 65, 184, 43, 116, 50, 192, 144, 115, 70], [178, 61, 184, 85, 24, 104, 81, 120, 122, 129, 33, 133, 98, 193, 30, 55, 34, 21, 95, 61], [199, 197, 140, 39, 150, 10, 131, 113, 65, 122, 48, 1, 14, 147, 20, 169, 196, 112, 44, 73], [158, 12, 100, 158, 179, 166, 28, 183, 168, 128, 116, 9, 135, 134, 158, 87, 87, 16, 120, 11], [73, 59, 180, 31, 156, 72, 88, 175, 192, 83, 1, 142, 192, 112, 143, 157, 115, 10, 150, 185], [16, 187, 128, 102, 175, 107, 164, 110, 95, 16, 69, 148, 76, 57, 110, 105, 25, 44, 166, 101], [86, 29, 177, 10, 184, 111, 2, 78, 194, 185, 154, 62, 61, 164, 68, 186, 200, 105, 119, 180], [195, 137, 92, 10, 190, 177, 13, 22, 32, 96, 163, 97, 187, 20, 162, 188, 23, 45, 14, 60], [108, 167, 187, 51, 52, 173, 90, 21, 25, 168, 200, 168, 55, 51, 94, 48, 58, 37, 156, 75], [129, 147, 98, 151, 148, 15, 154, 14, 123, 102, 111, 165, 27, 144, 54, 14, 101, 124, 189, 57]]
mat = matrix(mat).T
flag = ""
for i in mat.solve_right(x).list():
    flag += chr(int(i))
print(flag)
